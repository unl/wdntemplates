(function(a){a.fn.extend({infiniteCarousel:function(v){v=a.extend({transitionSpeed:800,displayTime:6E3,textholderHeight:0.15,displayProgressBar:true,displayThumbnails:true,displayThumbnailNumbers:true,displayThumbnailBackground:true,easeLeft:"linear",easeRight:"linear",inView:1,advance:1,showControls:true,autoHideControls:false,autoHideCaptions:false,autoStart:true,prevNextInternal:true,enableKeyboardNav:true,onSlideStart:function(){},onSlideEnd:function(){},onPauseClick:function(){}},v);return this.each(function(){function D(e){e=
e||c.displayTime;a("#progress"+b).css({width:null,height:null});a("#progress"+b).animate({width:0},e)}function w(e,m){if(h){a("#minmax"+b+"_"+m).hide();a("#close"+b+"_"+m).hide()}if(e!=null){a("#textholder"+b+"_"+m+" span").html(e);a("#textholder"+b+"_"+m).stop().animate({marginBottom:"0px"},500);a("#minmax"+b+"_"+m).removeClass("min");E()}}function E(){if(!h){a(".minmax",d).fadeIn(250);a(".close",d).fadeIn(250)}}function y(){a(".textholder",d).stop().animate({marginBottom:-n*c.textholderHeight-k-
12+"px"},c.transitionSpeed)}function F(){c.enableKeyboardNav&&a(document).bind("keydown.ic",function(e){if(e.keyCode==39){o("next");a(document).unbind("keydown.ic")}if(e.keyCode==37){o("prev");a(document).unbind("keydown.ic")}if(e.keyCode==80||e.keyCode==111)z();if(e.keyCode==83||e.keyCode==115){s();a(document).unbind("keydown.ic")}})}function o(e){c.onPauseClick.call(this);a("#btn_rt"+b).unbind("click");a("#btn_lt"+b).unbind("click");setTimeout(function(){a("#play_pause_btn"+b).addClass("play")},
c.transitionSpeed-1);h=0;a("#progress"+b).stop().fadeOut();p="pause";clearTimeout(t);e=="prev"?G():q();a("#play_pause_btn"+b).unbind("click");setTimeout(function(){a("#play_pause_btn"+b).bind("click",function(){s()});a("#btn_rt"+b).bind("click",function(){o("next")});a("#btn_lt"+b).bind("click",function(){o("prev")})},c.transitionSpeed)}function z(){a("#play_pause_btn"+b).unbind("click");if(h){c.onPauseClick.call(this);a("#play_pause_btn"+b).fadeTo(250,0,function(){a(this).addClass("play").css({opacity:A})}).animate({opacity:A},
250);h=0;E();a("#progress"+b).stop().fadeOut();clearTimeout(t);setTimeout(function(){a("#play_pause_btn"+b).bind("click",function(){s()})},c.transitionSpeed)}}function s(){a("#play_pause_btn"+b).unbind("click");if(!h){setTimeout(function(){a("#play_pause_btn"+b).removeClass("play")},c.transitionSpeed-1);h=1;q();t=setInterval(function(){q()},c.displayTime+c.transitionSpeed);setTimeout(function(){a("#play_pause_btn"+b).bind("click",function(){z()})},c.transitionSpeed)}}function H(){y();if(c.showControls&&
c.prevNextInternal){a("#play_pause_btn"+b).fadeOut(200);a("#btn_lt"+b).fadeOut(200);a("#btn_rt"+b).fadeOut(200)}if(c.displayThumbnails)for(i=1;i<=l;i++)a("#thumb"+b+"_"+i).removeClass("active")}function I(){if(c.showControls&&c.prevNextInternal){a("#play_pause_btn"+b).fadeIn(200);a("#btn_lt"+b).fadeIn(200);a("#btn_rt"+b).fadeIn(200)}F();c.autoHideCaptions&&B&&J();if(c.displayThumbnails)for(i=0;i<f.length;i++)a("#thumb"+b+"_"+f[i]).addClass("active");if(!c.autoHideCaptions)for(i=1;i<=c.inView;i++)w(a("li:eq("+
i+") p",d).html(),i);c.displayThumbnails&&a("#thumbs"+b+" div").unbind("click").bind("click",K).css({cursor:"pointer"});ary=[];for(x=1;x<=c.inView;x++)ary.push(a("img:eq("+x+")",d).attr("src"));c.onSlideEnd.call(this,ary)}function q(e){if(e==null)e=c.advance;H();if(c.displayThumbnails)for(i=1;i<=e;i++){f.push(r.shift());r.push(f.shift())}c.displayTime==0&&clearInterval(t);c.onSlideStart.call(this,f,"left");if(e==l-1){a("li:eq(0)",d).insertAfter(a("li:last",d));a("ul",d).css({left:0});e-=1}a("ul",
d).animate({left:-g*(e+1)},c.transitionSpeed,c.easeLeft,function(){a("li:lt("+e+")",d).insertAfter(a("li:last",d));a(this).css({left:-g});c.displayProgressBar&&h&&D();I();c.displayTime==0&&q()})}function G(e){if(e==null)e=c.advance;H();if(c.displayThumbnails)for(i=1;i<=e;i++){f.unshift(r.pop());r.unshift(f.pop())}var m=e;if(e==l-1){a("li:eq(0)",d).insertAfter(a("li:last",d));a("ul",d).css({left:0});e-=1;var C=0}else C=1;a("li:gt("+(l-(m+1))+")",d).insertBefore(a("li:first",d));c.onSlideStart.call(this,
f,"right");a("ul",d).css({left:-(g*(e+1))}).animate({left:-g*C},c.transitionSpeed,c.easeRight,function(){if(!C){a("li:last",d).prependTo(a("ul",d));a("ul",d).css("left",-g+"px")}I()})}var b=Math.round(Math.random()*1E8),c=v,d=a(this),h=c.autoStart,l=a("img",d).length,n=a("img:first",d).height(),g=a("img:first",d).width();if(c.inView>l-1)c.inView=l-1;a("p",d).hide();a(d).addClass("ic-wrapper");a(d).width(g*c.inView).height(n);a("ul",d).width(g*l);c.displayProgressBar&&a(d).append('<div id="progress'+
b+'" class="ic-progress-bar" />');var k=parseInt(a(d).css("border-bottom-width"))+parseInt(a(d).css("border-top-width"));if(isNaN(k))k=0;var j=parseInt(a(d).css("padding-left"));for(i=1;i<=c.inView;i++){a('<div id="textholder'+b+"_"+i+'" class="textholder"><span /></div>').css({width:g,height:n*c.textholderHeight,"margin-bottom":-(n*c.textholderHeight+k),left:(i-1)*g,"margin-left":j}).appendTo(d);html='<div class="minmax" id="minmax'+b+"_"+i+'" />';html+='<div class="close" id="close'+b+"_"+i+'" />';
a("#textholder"+b+"_"+i).append(html);a("#minmax"+b+"_"+i).hide();a("#close"+b+"_"+i).hide();c.autoHideCaptions||w(a("li:eq("+(i-1)+") p",d).html(),i)}j=parseInt(a("#textholder"+b+"_1").css("padding-left"))+parseInt(a("#textholder"+b+"_1").css("padding-right"));j>0&&a(".textholder",d).width(g-j);a(".close",d).each(function(e){a(this).click(function(){a("#textholder"+b+"_"+(e+1)).animate({marginBottom:-n*c.textholderHeight-k-12+"px"},500)})});a(".minmax",d).each(function(e){a(this).click(function(){parseInt(a("#textholder"+
b+"_"+(e+1)).css("margin-bottom"))==0?a("#textholder"+b+"_"+(e+1)).animate({marginBottom:-n*c.textholderHeight-k+12+"px"},500,function(){a("#minmax"+b+"_"+(e+1)).addClass("min")}):a("#textholder"+b+"_"+(e+1)).animate({marginBottom:"0px"},500,function(){a("#minmax"+b+"_"+(e+1)).removeClass("min")})})});if(c.displayThumbnails){function K(){target_num=this.id.split("_");if(f[0]!=target_num[1]){p="pause";a("#progress"+b).stop().fadeOut();clearTimeout(t);a("#thumbs"+b+" div").css({cursor:"default"}).unbind("click");
h=0;setTimeout(function(){a("#play_pause_btn"+b).addClass("play")},c.transitionSpeed);a("#play_pause_btn"+b).unbind("click").bind("click",function(){s()})}if(target_num[1]>f[0]){diff=target_num[1]-f[0];q(diff)}if(target_num[1]<f[0]){diff=f[0]-target_num[1];G(diff)}}var f=[],r=[];a(d).after('<div id="thumbs'+b+'" class="thumb-wrapper" />');for(i=0;i<l;i++){thumb=a("img:eq("+i+")",d).attr("src");j=a('<div class="thumb" id="thumb'+b+"_"+(i+1)+'" />');j.hover(function(){a(this).animate({opacity:N},150)},
function(){a.inArray(parseInt(this.id.split("_")[1]),f)<0?a(this).animate({opacity:O},250,function(){a(this).css("opacity",null)}):a(this).css("opacity",null)}).bind("click",K);thumb&&c.displayThumbnailBackground&&j.css({"background-image":"url("+thumb+")"});c.displayThumbnailNumbers&&j.text(i+1);a("#thumbs"+b).append(j);i<=c.inView&&a("#thumb"+b+"_"+i).addClass("active");var N=a("#thumbs"+b+" div.thumb.active").css("opacity")||1,O=a("#thumbs"+b+" div.thumb:not(.active)").css("opacity")||0.65;r.push(i+
1)}for(i=1;i<=c.inView;i++)f.push(r.shift())}a("li:last",d).prependTo(a("ul",d));a("ul",d).css("left",-g+"px");if(c.showControls){a('<div class="playpause" id="play_pause_btn'+b+'" />').appendTo(d);var p="play",A=a("#play_pause_btn"+b).css("opacity")||0.5;a("#play_pause_btn"+b).hover(function(){a(this).animate({opacity:"1"},250)},function(){a(this).animate({opacity:A},250)});a("#play_pause_btn"+b).click(function(){p=p=="play"?"pause":"play";p=="play"?s():z()});if(!c.prevNextInternal){wrapID=a(d).attr("id")+
"Wrapper";a(d).wrap('<div id="'+wrapID+'"></div>').css("margin","0 auto");a("#"+wrapID).css("position","relative").width(a(d).width()+40+parseInt(a(d).css("padding-left"))+parseInt(a(d).css("padding-right")))}var u=n/2-15;a('<div id="btn_rt'+b+'" class="btn_rt" />').css({top:u+"px"}).appendTo(c.prevNextInternal?d:a("#"+wrapID));a('<div id="btn_lt'+b+'" class="btn_lt" />').css({top:u+"px"}).appendTo(c.prevNextInternal?d:a("#"+wrapID));var L=a("#btn_rt"+b).css("opacity")||0.5;a("#btn_rt"+b).click(function(){o("next")}).hover(function(){a(this).animate({opacity:"1"},
250)},function(){a(this).animate({opacity:L},250)});a("#btn_lt"+b).click(function(){o("prev")}).hover(function(){a(this).animate({opacity:"1"},250)},function(){a(this).animate({opacity:L},250)});if(c.autoHideControls&&c.prevNextInternal){function P(){a("#play_pause_btn"+b).stop().animate({top:"3px",right:"3px"},250);a("#btn_rt"+b).stop().animate({top:u+"px",right:"2px"},250);a("#btn_lt"+b).stop().animate({top:u+"px",left:"2px"},250)}function M(){a("#play_pause_btn"+b).stop().animate({top:-16-k+"px",
right:-16-k+"px"},250);a("#btn_rt"+b).stop().animate({right:"-16px"},250);a("#btn_lt"+b).stop().animate({left:"-16px"},250)}a(d).hover(P,M);M()}if(c.autoHideCaptions){var B;function J(){B=true;for(i=1;i<=c.inView;i++)w(a("li:eq("+i+") p",d).html(),i)}function Q(){B=false;y()}a(d).hover(J,Q);y()}}if(h){var t=setInterval(function(){q()},c.displayTime+c.transitionSpeed);c.displayProgressBar&&D(c.displayTime+c.transitionSpeed)}else{p="pause";a("#play_pause_btn"+b).addClass("play")}F()})}})})(WDN.jQuery);
